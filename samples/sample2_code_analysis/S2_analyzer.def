# Programming Code Analysis Language
# Analyzes source code for functions, variables, strings, comments, etc.

%%LEX
# Code constructs
FUNCTION_DEF [a-zA-Z_][a-zA-Z0-9_]*\(
VARIABLE_ASSIGN [a-zA-Z_][a-zA-Z0-9_]*[ \t]*=
STRING_LITERAL \"[^\"]*\"
COMMENT_LINE \/\/[^\n]*

# Keywords
IF_KEYWORD if
ELSE_KEYWORD else
FOR_KEYWORD for
WHILE_KEYWORD while
RETURN_KEYWORD return

# Identifiers and literals
IDENTIFIER [a-zA-Z_][a-zA-Z0-9_]*
NUMBER [0-9]+\.?[0-9]*

# Operators and punctuation
EQUALS =
SEMICOLON ;
LPAREN \(
RPAREN \)
LBRACE \{
RBRACE \}
COMMA ,
DOT \.
PLUS \+
MINUS -
STAR \*
SLASH \/

# Whitespace
NEWLINE \n
WHITESPACE [ \t\r]+

%%YACC
# Program structure
program -> statement_list
    { $$ = create_node("code_program", 1, $1); }

statement_list -> statement
    { $$ = create_node("statement_list", 1, $1); }
    | statement_list statement
    { $$ = create_node("statement_list", 2, $1, $2); }

# Statements
statement -> function_def
    { $$ = create_node("statement", 1, $1); }
    | variable_assign
    { $$ = create_node("statement", 1, $1); }
    | keyword
    { $$ = create_node("statement", 1, $1); }
    | token
    { $$ = create_node("statement", 1, $1); }

# Function definition
function_def -> FUNCTION_DEF
    { $$ = create_node("function_definition", 1, $1); }

# Variable assignment
variable_assign -> VARIABLE_ASSIGN
    { $$ = create_node("variable_assignment", 1, $1); }

# Keywords
keyword -> IF_KEYWORD
    { $$ = create_node("if_statement", 1, $1); }
    | ELSE_KEYWORD
    { $$ = create_node("else_statement", 1, $1); }
    | FOR_KEYWORD
    { $$ = create_node("for_loop", 1, $1); }
    | WHILE_KEYWORD
    { $$ = create_node("while_loop", 1, $1); }
    | RETURN_KEYWORD
    { $$ = create_node("return_statement", 1, $1); }

# Generic tokens
token -> STRING_LITERAL
    { $$ = create_node("string_literal", 1, $1); }
    | COMMENT_LINE
    { $$ = create_node("comment", 1, $1); }
    | IDENTIFIER
    { $$ = create_node("identifier", 1, $1); }
    | NUMBER
    { $$ = create_node("number", 1, $1); }
    | operator
    { $$ = $1; }
    | NEWLINE
    { $$ = create_leaf_node("newline", "\\n"); }

# Operators
operator -> EQUALS
    { $$ = $1; }
    | SEMICOLON
    { $$ = $1; }
    | LPAREN
    { $$ = $1; }
    | RPAREN
    { $$ = $1; }
    | LBRACE
    { $$ = $1; }
    | RBRACE
    { $$ = $1; }
    | COMMA
    { $$ = $1; }
    | DOT
    { $$ = $1; }
    | PLUS
    { $$ = $1; }
    | MINUS
    { $$ = $1; }
    | STAR
    { $$ = $1; }
    | SLASH
    { $$ = $1; }
