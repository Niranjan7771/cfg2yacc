# Medical Report Analysis Language
# Analyzes medical records for patient vitals, test results, and diagnoses

%%LEX
# Patient identification
PATIENT_ID [A-Z]{2}[0-9]{6}
BLOOD_TYPE (A|B|AB|O)[+-]

# Medical measurements
BLOOD_PRESSURE [0-9]{2,3}\/[0-9]{2,3}
TEMPERATURE [0-9]{2,3}\.[0-9]{1,2}(F|C)
HEART_RATE [0-9]{2,3}bpm
WEIGHT [0-9]{2,3}(kg|lbs)
HEIGHT [0-9]{1}\.[0-9]{2}m|[0-9]{2,3}cm
GLUCOSE_LEVEL [0-9]{2,3}mg\/dL

# Medical codes and IDs
PRESCRIPTION Rx[0-9]{8}
DIAGNOSIS_CODE ICD[0-9]{2}-[A-Z][0-9]{2}
DOCTOR_ID Dr\.[A-Z][a-z]+

# Date and time
DATE_MEDICAL [0-9]{2}\/[0-9]{2}\/[0-9]{4}
TIME_MEDICAL [0-9]{2}:[0-9]{2}(AM|PM)

# Medical keywords
TEST_RESULT Positive|Negative|Pending|Abnormal|Normal
SEVERITY Critical|Severe|Moderate|Mild
DEPARTMENT Cardiology|Neurology|Orthopedics|Pediatrics|Emergency|ICU|Radiology

# Demographics
GENDER Male|Female|Other
AGE_UNIT years|yrs

# Medication
DOSAGE_FORM tablet|tablets|capsule|capsules|pill|pills|dose|doses|ml|mg

# General
WORD [a-zA-Z]+
NUMBER [0-9]+
SLASH \/
NEWLINE \n
WHITESPACE [ \t\r]+

%%YACC

document -> item_list
    { $$ = create_node("medical_document", 1, $1); }

item_list -> item
    { $$ = create_node("item_list", 1, $1); }
    | item_list item
    { $$ = create_node("item_list", 2, $1, $2); }

item -> PATIENT_ID
    { $$ = create_node("patient_id", 1, $1); }
    | BLOOD_TYPE
    { $$ = create_node("blood_type", 1, $1); }
    | BLOOD_PRESSURE
    { $$ = create_node("blood_pressure", 1, $1); }
    | TEMPERATURE
    { $$ = create_node("temperature", 1, $1); }
    | HEART_RATE
    { $$ = create_node("heart_rate", 1, $1); }
    | WEIGHT
    { $$ = create_node("weight", 1, $1); }
    | HEIGHT
    { $$ = create_node("height", 1, $1); }
    | GLUCOSE_LEVEL
    { $$ = create_node("glucose_level", 1, $1); }
    | PRESCRIPTION
    { $$ = create_node("prescription", 1, $1); }
    | DIAGNOSIS_CODE
    { $$ = create_node("diagnosis_code", 1, $1); }
    | DOCTOR_ID
    { $$ = create_node("doctor", 1, $1); }
    | DATE_MEDICAL
    { $$ = create_node("date", 1, $1); }
    | TIME_MEDICAL
    { $$ = create_node("time", 1, $1); }
    | TEST_RESULT
    { $$ = create_node("test_result", 1, $1); }
    | SEVERITY
    { $$ = create_node("severity", 1, $1); }
    | DEPARTMENT
    { $$ = create_node("department", 1, $1); }
    | GENDER
    { $$ = create_node("gender", 1, $1); }
    | DOSAGE_FORM
    { $$ = create_node("dosage_form", 1, $1); }
    | AGE_UNIT
    { $$ = create_node("age_unit", 1, $1); }
    | WORD
    { $$ = create_node("word", 1, $1); }
    | NUMBER
    { $$ = create_node("number", 1, $1); }
    | NEWLINE
    { $$ = create_leaf_node("newline", "\\n"); }
